# Сборка ядра

Процесс сборки ядра занимает немалое количество времени, особенно в виртуальной среде. По умолчанию Vagrant выделяет небольшое количество ядре и оперативной памяти, и поэтому для уменьшения времени компиляции ядра необходимо выделить виртуальной машине как можно больше ядер и оперативной памяти. Осуществить это можно путем внесения определенных параметров в файл Vagrantfile. Данный процесс подробно расписан в одном из заданий первой лабораторной работы.

## Скачивание исходных файлов ядра Linux

Загрузите в директорию "/usr/scr/" исходный код ядра Linux версии 4.17 

```bash
$ wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.14.10.tar.xz
```

Извлеките файлы из скачанного архива используя следующие команду

```bash
$ tar -xvf linux-4.14.10.tar.xz
```

После перейдите в директорию куда были извлечены файлы

```bash
$ cd linux-4.14.10/
```

## Настройка параметров ядра Linux 

Перед компиляцией необходимо установить правильные параметры ядра, иначе оно просто не будет работать. 

Оптимальным вариантом будет воспользоваться готовым конфигурационным файлом, который находиться в директории "/boot"

```bash
$ sudo cp -v /boot/config-$(uname -r) ~/linux-4.14.10/.config
```

Чтобы запустить программу для управления параметрами ядра Linux достаточно выполнить следующую команду:

```bash
$ sudo make menuconfig
```

В качестве индивидуального задания будет являться изучение конфигуратора ядра, а также изучение и установка произвольного параметра в конфигураторе.  

По завершении выберите с помощью клавиш стрелок пункт меню "Save" и нажмите два раза клавишу "Enter". 

Выход из конфигуратора  осуществляться с помощью пункта меню "Exit".

## Компиляция ядра Linux

{% hint style="warning" %}
Перед установкой компиляции и установкой ядра необходимо сделать снимок, поскольку после установки виртуальная машина может не загрузиться.
{% endhint %}

Для компиляции ядра необходимо выполнить следующие команды:

```bash
$ make rpm-pkg
$ sudo rpm -iUv ~/rpmbuild/RPMS/x86_64/*.rpm
```

Процесс компиляции может занять несколько часов. После завершения компиляции перезагрузите систему и проверьте версию установленного ядра.

```bash
$ reboot
```

Проверить версию установленного ядра в системе можно с помощью следующей команды: 

```bash
$ uname -sr
```

